# Quality Camp Demo

This example demonstrates how to build, test, and manage a simple application using **Konflux CI**. Konflux CI provides a streamlined approach to continuous integration, allowing for containerized builds and robust testing workflows.

## Overview

This guide covers:
- Setting up the repository for container builds
- Adding integration tests
- Configuring artifact storage
- Running the entire process via a pull request

## Prerequisites

Before proceeding, ensure that you have access to:
- A Konflux CI workspace
- Quay (or another OCI-compatible container registry) credentials
- A GitHub account to fork and manage this repository

### 1. Forking the Repository and Building the Container

1. **Fork this repository** to your own GitHub account to get started.
2. **Set up the application and component** within your Konflux CI environment:
   - Follow the [Konflux CI Application and Component Creation Guide](https://konflux-ci.dev/docs/how-tos/creating/) for detailed instructions.
   - Ensure that your application and component configurations align with the CI/CD pipeline’s requirements.

### 2. Setting Up Integration Tests

Integration tests verify that various parts of your application interact as expected. Follow these steps to set up integration tests in Konflux CI.

1. **Add Integration Tests**:
   - Use the Konflux CI guide on [adding integration tests](https://konflux-ci.dev/docs/how-tos/testing/integration/adding/).
   - Refer to the [example pipelines](https://konflux-ci.dev/docs/how-tos/testing/integration/adding/) and main branch.

2. **Configure Test Artifacts Storage**:
   - To collect test artifacts, create a secret in your Konflux workspace. This secret contains your storage credentials, which allow Konflux CI to store and retrieve test results.
   - Use the following YAML configuration as a template for your secret:

     ```yaml
     kind: Secret
     apiVersion: v1
     metadata:
       name: konflux-test-infra
       namespace: <workspace-tenant>
     data:
       oci-storage: 
       # Encode JSON with credentials in base64 format, then paste here
       {"quay-token":"abc","quay-username":"abc"}
     type: Opaque
     ```

   - Replace `<workspace-tenant>` with the name of your Konflux workspace tenant.
   - Encode your Quay credentials in base64 before adding them to the secret.

3. **Set Up an OCI Repository for Test Artifacts**:
   - Create a repository on Quay to store OCI artifacts generated by the integration tests.
   - Pass this repository as a parameter within the integration test pipeline configuration:

     ```yaml
     - name: oci-container-repo
       default: 'quay.io/konflux-test-storage/quality-camp/k8s-demo'
       description: The ORAS container used to store all test artifacts.
     ```

   - Replace `quay.io/konflux-test-storage/quality-camp/k8s-demo` with your actual Quay repository path.
   - This repository will store test results and other artifacts, making it easier to review and debug any issues.

## Running the Build and Tests

To initiate the the konflux pipeline, follow these steps:

1. **Open a Pull Request (PR)**:
   - Once you’ve made changes to the repository (e.g., added components or integration tests), open a pull request. This triggers the Konflux CI pipeline.

2. **Monitor the Pipeline**:
   - The pipeline first builds the container.
   - After a successful build, the pipeline automatically initiates the integration tests.

3. **Review Test Results**:
   - Upon completion, check the Konflux CI dashboard for test results and artifacts.
   - Use logs and artifacts stored in the OCI repository for any additional debugging or review.

## Example Workflow

Here’s an example workflow summary for using this setup:

1. **Clone and Fork**:
   - Fork this repo and clone it locally.
   - Make any necessary code or configuration changes to the application.

2. **Set Up Components and Tests**:
   - Configure application components based on the Konflux CI guidelines.
   - Add integration tests and configure artifact storage as per the steps above.

3. **Push and Create PR**:
   - Push changes to your forked repo.
   - Open a pull request in the GitHub repository to trigger the build and test pipeline.

4. **Monitor and Debug**:
   - Check Konflux CI’s feedback on build and test success.
   - Access artifacts in your configured OCI repository for further inspection if needed.

5. **Merge and Deploy**:
   - Once all tests pass, merge the PR to complete the deployment.

## Additional Resources

- [Konflux CI Documentation](https://konflux-ci.dev/docs/)
- [Creating Components in Konflux CI](https://konflux-ci.dev/docs/how-tos/creating/)
- [Adding Integration Tests](https://konflux-ci.dev/docs/how-tos/testing/integration/adding/)

 ---

This guide should give you a comprehensive overview of setting up, running, and managing your application’s CI/CD pipeline with Konflux CI.
